{"version":3,"sources":["../src/ReactCloudinaryUploader.js"],"names":["ReactCloudinaryUploader","state","bytes","createdAt","etag","format","height","width","path","publicId","resourceType","secure_url","signature","tags","thumbnailUrl","type","url","version","isError","errorMessage","showPoweredBy","allowedFormats","uuid","guid","s4","Math","floor","random","toString","substring","options","cloud_name","props","cloudName","upload_preset","uploadPreset","sources","multiple","maxFiles","max_files","cropping","croppingAspectRatio","cropping_aspect_ratio","public_id","folder","length","context","contextAlt","alt","contextCaption","caption","Object","keys","setState","uploadedImage","console","log","created_at","resource_type","secureUrl","thumbnail_url","onUploadSuccess","ev","self","getUploadOptions","e","setError","Error","uploader_id","image","buttonClass","handleClick","buttonCaption","Promise","fulfil","reject","cloudinary","openUploadWidget","error","result","map","replace","returnJustUrl","Component","defaultProps","defaultSource","croppingAspectRation","maxFileSize","maxImageWidth","maxImageHeight"],"mappings":"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","file":"ReactCloudinaryUploader.js","sourcesContent":["import React, {Component} from 'react';\n\nclass ReactCloudinaryUploader extends Component {\n\n    constructor() {\n        super();\n        this.state = {\n            bytes: null,\n            createdAt: null,\n            etag: null,\n            format: null,\n            height: null,\n            width: null,\n            path: null,\n            publicId: null,\n            resourceType: null,\n            secure_url: null,\n            signature: null,\n            tags: [],\n            thumbnailUrl: null,\n            type: null,\n            url: null,\n            version: null,\n            isError: false,\n            errorMessage: null,\n            showPoweredBy: false,\n            allowedFormats: null,\n            uuid: this.uuid()\n        };\n    }\n\n    static open(options) {\n        console.log(\"open\");\n\n        return new Promise((fulfil, reject) => {\n            cloudinary.openUploadWidget(options,\n                (error, result) => {\n                    if (error) {\n                        reject(error);\n                        return false;\n                    }\n                    if (!result || result.length === 0) {\n                        reject(new Error(\"No result from Cloudinary\"));\n                        return false;\n                    }\n\n                    result = result.map(image => {\n                        image.url = `https://${image.url.replace('http://','')}`\n                        return image;\n                    });\n\n                    if (options.returnJustUrl)\n                        result = result.map(image=>image.url);\n\n                    if (!options.multiple)\n                        result = result[0];\n\n                    fulfil(result);\n                    return true;\n                }\n            );\n        });\n    }\n\n    uuid() {\n        function guid() {\n            function s4() {\n                return Math.floor((1 + Math.random()) * 0x10000)\n                    .toString(16)\n                    .substring(1);\n            }\n\n            return s4() + s4() + '-' + s4() + '-' + s4() + '-' +\n                s4() + '-' + s4() + s4() + s4();\n        }\n\n        return guid();\n    }\n\n    getUploadOptions() {\n        let options = {\n            cloud_name: this.props.cloudName,\n            upload_preset: this.props.uploadPreset\n        };\n        options.sources = this.props.sources;\n        options.multiple = this.props.multiple;\n\n        if (this.props.maxFiles) {\n            options.max_files = this.props.maxFiles\n        }\n\n        if (this.props.cropping && this.props.cropping === 'server') {\n            options.cropping = this.props.cropping;\n        }\n\n        if (this.croppingAspectRatio) {\n            options.cropping_aspect_ratio = this.props.croppingAspectRatio;\n        }\n\n        if (this.props.publicId) {\n            options.public_id = this.props.publicId;\n        }\n\n        if (this.props.folder) {\n            options.folder = this.props.folder;\n        }\n\n        if (this.props.tags && this.props.tags.length > 0) {\n            options.tags = this.props.tags;\n        }\n\n        if (this.props.resourceType) {\n            options.resourceType = this.props.resourceType;\n        }\n\n        if (this.props.allowedFormats) {\n            options.allowedFormats = this.props.allowedFormats\n        }\n\n        let context = {};\n        if (this.props.contextAlt) {\n            context.alt = this.props.contextAlt;\n        }\n\n        if (this.props.contextCaption) {\n            context.caption = this.props.contextCaption;\n        }\n\n        if (Object.keys(context).length > 0) {\n            options.context = context;\n        }\n\n        return options;\n    }\n\n    setError(isError, errorMessage) {\n        this.setState({\n            isError: true,\n            errorMessage: 'No result returned from Cloudinary'\n        });\n    }\n\n    setUploadResult(uploadedImage) {\n        console.log(\"uploadedImage\", uploadedImage);\n        this.setState({\n            bytes: uploadedImage.bytes,\n            createdAt: uploadedImage.created_at,\n            etag: uploadedImage.etag,\n            format: uploadedImage.format,\n            height: uploadedImage.height,\n            path: uploadedImage.path,\n            publicId: uploadedImage.public_id,\n            resourceType: uploadedImage.resource_type,\n            secureUrl: uploadedImage.secure_url,\n            signature: uploadedImage.signature,\n            tags: uploadedImage.tags,\n            thumbnailUrl: uploadedImage.thumbnail_url,\n            type: uploadedImage.type,\n            url: uploadedImage.url,\n            version: uploadedImage.version,\n            width: uploadedImage.width\n        });\n        if (this.props.onUploadSuccess)\n            this.props.onUploadSuccess(uploadedImage);\n    }\n\n    handleClick(ev) {\n        let self = this;\n        console.log(this);\n        try {\n            let options = this.getUploadOptions();\n            // call promise staticaly\n\n            // cloudinary.openUploadWidget(options,\n            //     (error, result) => {\n            //         if (error) {\n            //             self.setError(true, error);\n            //             return false;\n            //         }\n            //\n            //         if (!result || result.length === 0) {\n            //             self.setError(true, 'No result from Cloudinary');\n            //             return false;\n            //         }\n            //         var uploadedImage = result[0];\n            //         self.setUploadResult(uploadedImage);\n            //         return true;\n            //     }\n            // );\n        } catch (e) {\n            self.setError(true, e);\n            return false;\n        }\n\n    }\n\n    render() {\n        console.log(this.props);\n        if (!this.props.cloudName || !this.props.uploadPreset)\n            throw new Error(\"cloudName and uploadPreset props must be set\");\n\n        let uploader_id = \"uploader_\" + this.state.uuid;\n        let image = this.state.thumbnailUrl ? this.state.thumbnailUrl : '#';\n        return (\n            <section>\n                <div>\n                    <img src={image}/>\n                </div>\n                <a ref='uploader' id={uploader_id} href=\"#\"\n                   className={this.props.buttonClass}\n                   onClick={() => this.handleClick()}>{this.props.buttonCaption}</a>\n            </section>\n        );\n    }\n}\n\n// ReactCloudinaryUploader.propTypes = {\n//     cloudName: React.PropTypes.string.isRequired,\n//     uploadPreset: React.PropTypes.string.isRequired,\n//     showPoweredBy: React.PropTypes.bool,\n//     allowedFormats: React.PropTypes.array,\n//     maxFileSize: React.PropTypes.number,\n//     maxImageWidth: React.PropTypes.number,\n//     maxImageHeight: React.PropTypes.number,\n//     sources: React.PropTypes.arrayOf(React.PropTypes.string),\n//     defaultSource: React.PropTypes.string,\n//     multiple: React.PropTypes.bool,\n//     maxFiles: React.PropTypes.number,\n//     cropping: React.PropTypes.string,\n//     croppingAspectRatio: React.PropTypes.number,\n//     publicId: React.PropTypes.string,\n//     folder: React.PropTypes.string,\n//     tags: React.PropTypes.arrayOf(React.PropTypes.string),\n//     resourceType: React.PropTypes.string,\n//     contextAlt: React.PropTypes.string,\n//     contextCaption: React.PropTypes.string,\n//     buttonClass: React.PropTypes.string,\n//     buttonCaption: React.PropTypes.string,\n//     onUploadSuccess: React.PropTypes.object\n// };\n\nReactCloudinaryUploader.defaultProps = {\n    showPoweredBy: false,\n    sources: ['local', 'url', 'camera'],\n    defaultSource: 'local',\n    multiple: false,\n    maxFiles: null,\n    cropping: null,\n    croppingAspectRation: null,\n    publicId: null,\n    folder: null,\n    tags: null,\n    resourceType: 'auto',\n    contextAlt: null,\n    contextCaption: null,\n    allowedFormats: ['png', 'gif', 'jpeg'],\n    maxFileSize: null,\n    maxImageWidth: null,\n    maxImageHeight: null,\n    buttonClass: 'cloudinary-button',\n    buttonCaption: 'Upload image'\n};\n\nexport default ReactCloudinaryUploader;\n"]}